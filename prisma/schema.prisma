// Prisma schema for BisqueBook2
// Database uses a hosted PostgreSQL connection.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model UserProfile {
  id        String   @id @default(cuid())
  userId    String   @unique
  email     String?
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  studiosOwned      Studio[]           @relation("StudioOwner")
  studioMemberships StudioMembership[]
  projects          Project[]          @relation("ProjectCreator")
  firingsHandled    Firing[]           @relation("FiringOperator")
}

model Studio {
  id                    String    @id @default(cuid())
  name                  String
  description           String?
  ownerId               String
  joinPasswordHash      String?
  joinPasswordSalt      String?
  joinPasswordUpdatedAt DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  owner       UserProfile        @relation("StudioOwner", fields: [ownerId], references: [id])
  memberships StudioMembership[]
  kilns       Kiln[]
  clays       Clay[]
  glazes      Glaze[]
  projects    Project[]
}

model StudioMembership {
  id        String                 @id @default(cuid())
  userId    String                 @unique
  studioId  String
  role      StudioMembershipRole   @default(Member)
  status    StudioMembershipStatus @default(Pending)
  createdAt DateTime               @default(now())
  updatedAt DateTime               @updatedAt

  studio Studio      @relation(fields: [studioId], references: [id])
  user   UserProfile @relation(fields: [userId], references: [id])

  @@unique([studioId, userId])
}

enum StudioMembershipRole {
  Admin
  Member
}

enum StudioMembershipStatus {
  Pending
  Approved
  Denied
  Removed
}

model Kiln {
  id             String   @id @default(cuid())
  studioId       String
  name           String
  type           String?
  maxTemperature Int?
  atmosphere     String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  studio  Studio   @relation(fields: [studioId], references: [id])
  firings Firing[]
}

model Clay {
  id           String   @id @default(cuid())
  studioId     String
  name         String
  manufacturer String?
  isActive     Boolean  @default(true)
  cone         String?
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  studio   Studio    @relation(fields: [studioId], references: [id])
  projects Project[]
}

model Glaze {
  id           String   @id @default(cuid())
  studioId     String
  name         String
  manufacturer String?
  color        String?
  cone         String?
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  studio   Studio    @relation(fields: [studioId], references: [id])
  projects Project[]
}

model Project {
  id          String   @id @default(cuid())
  studioId    String
  name        String
  description String?
  clayId      String?
  glazeId     String?
  createdById String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  studio    Studio       @relation(fields: [studioId], references: [id])
  clay      Clay?        @relation(fields: [clayId], references: [id])
  glaze     Glaze?       @relation(fields: [glazeId], references: [id])
  createdBy UserProfile? @relation("ProjectCreator", fields: [createdById], references: [id])
  firings   Firing[]
}

model Firing {
  id        String    @id @default(cuid())
  projectId String
  kilnId    String
  firedById String?
  type      String?
  cone      String?
  startTime DateTime?
  endTime   DateTime?
  notes     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  project Project      @relation(fields: [projectId], references: [id])
  kiln    Kiln         @relation(fields: [kilnId], references: [id])
  firedBy UserProfile? @relation("FiringOperator", fields: [firedById], references: [id])
}
